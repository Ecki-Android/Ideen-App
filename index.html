<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ideen-App Pro</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f4; }
    input, select, textarea, button { margin-top: 10px; padding: 10px; width: 100%; max-width: 500px; }
    .idee { background: white; padding: 15px; margin: 10px 0; border-radius: 8px; box-shadow: 0 0 5px #ccc; display: flex; align-items: flex-start; justify-content: space-between; }
    .idee-content { flex: 1; }
    .idee-checkbox { margin-left: 10px; margin-top: 5px; min-width: 28px; min-height: 28px; }
    .buttons { display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap; }
    .filter-bar { margin: 20px 0; }
    .filter-bar select { width: auto; }
    .idee-actions { margin-top: 10px; display: flex; gap: 5px; flex-wrap: wrap; }
    .idee-actions button { padding: 5px 10px; font-size: 0.9em; }
    .prio-btn { background: #eee; border: 1px solid #ccc; border-radius: 4px; }
    .prio-btn.selected { background: #ffd700; border-color: #ff9800; color: #222; }
    .warnung { color: #d32f2f; margin: 10px 0; font-weight: bold; }
    .datei-link { color: #1a0dab; text-decoration: underline; cursor: pointer; font-weight: bold; display: inline-block; margin-bottom: 8px; }
    .datei-info { font-size: 0.96em; color: #333; margin-bottom: 8px; }
    .datei-vorschau { margin: 10px 0; }
    .datei-vorschau a { display: block; margin: 3px 0; }
    .filter-option-alle { color: #666; font-style: italic; }
    .katHinweis { color: #c00; font-size: 0.95em; margin-left: 10px; }
    .katLoeschBtn { background:#eee;border:1px solid #c00;color:#c00; }
    #preview img { max-width: 300px; max-height: 200px; display: block; margin-top: 8px; border: 1px solid #888; }
    #preview iframe { width: 300px; height: 200px; border: 1px solid #888; margin-top: 8px; display: block; }
    .top-actions { margin-bottom: 12px; display: flex; gap: 10px; flex-wrap: wrap; }
    .hyperlink-container { margin: 10px 0 0 0; }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <h1>Ideen-App</h1>
  <div id="mobileHinweis" style="display:none; color:#1976d2; font-weight:bold; margin-bottom:10px;"></div>
  <div id="warnung" class="warnung" style="display:none;"></div>

  <input type="text" id="ideeText" placeholder="Titel*" />
  <textarea id="ideeDetails" placeholder="Beschreibung" rows="3"></textarea>
  <select id="kategorie"></select>
  <input type="text" id="neueKategorie" placeholder="Neue Kategorie" />
  <button onclick="neueKategorieHinzufuegen()">+ Kategorie</button>
  <button class="katLoeschBtn" onclick="kategorieLoeschen()">Kategorie lÃ¶schen</button>
  <span id="katHinweis" class="katHinweis" style="display:none;"></span>

  <div class="buttons">
    <button id="prioHoch" class="prio-btn" onclick="setzePrioritaet('Hoch')">ğŸ”´ Hoch</button>
    <button id="prioMittel" class="prio-btn" onclick="setzePrioritaet('Mittel')">ğŸŸ  Mittel</button>
    <button id="prioNiedrig" class="prio-btn" onclick="setzePrioritaet('Niedrig')">ğŸŸ¢ Niedrig</button>
  </div>

  <input type="file" id="dateien" multiple />
  <div class="datei-vorschau" id="dateiVorschau"></div>
  <div id="preview"></div>
  
  <button id="speichernBtn" onclick="speichereIdee()">ğŸ’¾ Speichern</button>
  <button id="abbrechenBtn" onclick="abbrechenBearbeiten()" style="display:none;">Abbrechen</button>

  <div class="filter-bar">
    <label>Filter:</label>
    <select id="filterKategorie" onchange="zeigeIdeen()">
      <option value="" class="filter-option-alle">ğŸ¯ Alle Ideen</option>
    </select>
    <label>Sortierung:</label>
    <select id="sortierung" onchange="zeigeIdeen()">
      <option value="neu">Neueste zuerst</option>
      <option value="alt">Ã„lteste zuerst</option>
      <option value="prio">Nach PrioritÃ¤t</option>
    </select>
  </div>

  <div class="top-actions">
    <button onclick="exportiereAlsPDF()">ğŸ“ PDF</button>
    <button onclick="exportiereAlsText()">ğŸ“„ Text</button>
    <button onclick="teilePerEmail()">âœ‰ï¸ E-Mail</button>
    <button onclick="teilePerWhatsApp()">ğŸ“± WhatsApp</button>
    <button onclick="alleIdeenLoeschen()" style="background:#eee;border:1px solid #c00;color:#c00;">Alle Ideen lÃ¶schen</button>
    <button onclick="ausgewaehlteNotizenLoeschen()" style="background:#eee;border:1px solid #c00;color:#c00;">AusgewÃ¤hlte lÃ¶schen</button>
    <button onclick="speichereIdeenAlsDatei()">Datei speichern</button>
    <button onclick="ladeIdeenAusDatei()">Datei Ã¶ffnen</button>
  </div>

  <div id="ideenListe"></div>
  <div id="exportLinkDialog" style="display:none;"></div>
  <div id="overlay" class="overlay" style="display:none;"></div>

  <script>
    // ... Der komplette JavaScript-Code bleibt wie in deiner letzten funktionierenden Version ...
    // Ersetze nur die Funktion zeigeIdeen() wie folgt:

    function zeigeIdeen() {
      const filter = document.getElementById("filterKategorie").value;
      const sortierung = document.getElementById("sortierung").value;
      let ideen = JSON.parse(localStorage.getItem("ideen") || "[]");
      let gefilterteIdeen = filter ? ideen.filter(i => i.kategorie === filter) : ideen.slice();

      if (sortierung === "neu") {
        gefilterteIdeen.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
      } else if (sortierung === "alt") {
        gefilterteIdeen.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
      } else if (sortierung === "prio") {
        const prio = { "Hoch": 3, "Mittel": 2, "Niedrig": 1 };
        gefilterteIdeen.sort((a, b) => prio[b.prioritaet] - prio[a.prioritaet]);
      }

      document.getElementById("ideenListe").innerHTML = gefilterteIdeen.map((idee, idx) => {
        const globalIdx = ideen.findIndex(i => i === idee);
        return `
        <div class="idee">
          <div class="idee-content">
            <h3>${idee.text}</h3>
            <p>${idee.details}</p>
            <small>${idee.kategorie} | ${idee.prioritaet} | ${idee.timestamp}</small>
            ${idee.dateien.map(file => `
              <a class="datei-link" href="${file.data}" target="_blank">ğŸ“ ${file.name}</a>
              <div class="datei-info">Speicherort: <i>${file.name}</i></div>
              ${
                file.type && file.type.startsWith("image/") 
                  ? `<img src="${file.data}" alt="${file.name}" style="max-width:150px;max-height:100px;border:1px solid #888;margin-bottom:8px;">`
                  : file.type === "application/pdf"
                    ? `<iframe src="${file.data}" style="width:150px;height:100px;border:1px solid #888;margin-bottom:8px;"></iframe>`
                    : ""
              }
            `).join("")}
            <div class="idee-actions">
              <button onclick="verschiebeIdee(${globalIdx}, -1)">â¬†ï¸</button>
              <button onclick="verschiebeIdee(${globalIdx}, 1)">â¬‡ï¸</button>
              <button onclick="bearbeiteIdee(${globalIdx})">âœï¸</button>
              <button onclick="loescheIdee(${globalIdx})">ğŸ—‘ï¸</button>
            </div>
          </div>
          <input type="checkbox" class="idee-checkbox" onchange="toggleAuswahl(${globalIdx},this)" ${ausgewaehlt.includes(globalIdx) ? "checked" : ""}>
        </div>
      `;
      }).join("");
    }

    // ... Rest deines JavaScript-Codes bleibt wie gehabt ...
    // (Funktionen fÃ¼r Speichern, Ã–ffnen, Export, Kategorien, Checkbox-Auswahl, etc.)
  </script>
</body>
</html>
