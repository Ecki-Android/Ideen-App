<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ideen-App</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f4; }
    h1 { color: #333; }
    input, select, textarea, button { margin-top: 10px; padding: 10px; width: 100%; max-width: 500px; }
    .idee { background: white; padding: 15px; margin: 10px 0; border-radius: 8px; box-shadow: 0 0 5px #ccc; }
    .buttons { display: flex; gap: 10px; margin-top: 10px; }
    .idee img { max-width: 100px; margin-top: 10px; }
    .filter-bar { margin: 20px 0; }
    .filter-bar select { width: auto; }
  </style>
</head>
<body>
  <h1>Willkommen in deiner Ideen-App, Egbert!</h1>

  <input type="text" id="ideeText" placeholder="Deine Idee..." />
  <textarea id="ideeDetails" placeholder="Details zur Idee..." rows="3"></textarea>

  <select id="kategorie">
    <option value="Privat">Privat</option>
    <option value="Arbeit">Arbeit</option>
    <option value="SpÃ¤ter">SpÃ¤ter</option>
    <option value="Sonstiges">Sonstiges</option>
  </select>
  <input type="text" id="neueKategorie" placeholder="Neue Kategorie hinzufÃ¼gen" />
  <button onclick="neueKategorieHinzufuegen()">+ Neue Kategorie</button>

  <div>
    <button onclick="setzePrioritaet('Hoch')">ðŸ”´ Hoch</button>
    <button onclick="setzePrioritaet('Mittel')">ðŸŸ  Mittel</button>
    <button onclick="setzePrioritaet('Niedrig')">ðŸŸ¢ Niedrig</button>
  </div>

  <input type="file" id="bilder" multiple accept="image/*" />
  <button onclick="speichereIdee()">ðŸ’¾ Speichern</button>

  <div class="filter-bar">
    <label>Kategorie filtern:</label>
    <select id="filterKategorie" onchange="zeigeIdeen()"></select>
    <label>Sortierung:</label>
    <select id="sortierung" onchange="zeigeIdeen()">
      <option value="neu">Neueste zuerst</option>
      <option value="alt">Ã„lteste zuerst</option>
      <option value="prio">Nach PrioritÃ¤t</option>
    </select>
  </div>

  <div id="ideenListe"></div>

  <script>
    let prioritaet = "";

    function setzePrioritaet(p) {
      prioritaet = p;
    }

    function neueKategorieHinzufuegen() {
      const neueKat = document.getElementById("neueKategorie").value;
      if (neueKat.trim()) {
        const katSelect = document.getElementById("kategorie");
        const filterSelect = document.getElementById("filterKategorie");
        const option = new Option(neueKat, neueKat);
        katSelect.add(option);
        filterSelect.add(option.cloneNode(true));
        document.getElementById("neueKategorie").value = "";
      }
    }

    function speichereIdee() {
      const text = document.getElementById("ideeText").value;
      const details = document.getElementById("ideeDetails").value;
      const kategorie = document.getElementById("kategorie").value;
      const bilder = document.getElementById("bilder").files;
      const now = new Date();
      const timestamp = now.toLocaleString("de-DE", {
        year: 'numeric', month: '2-digit', day: '2-digit',
        hour: '2-digit', minute: '2-digit', second: '2-digit',
        hour12: false
      });

      const readerPromises = Array.from(bilder).map(file => {
        return new Promise((resolve) => {
          const reader = new FileReader();
          reader.onload = () => resolve(reader.result);
          reader.readAsDataURL(file);
        });
      });

      Promise.all(readerPromises).then(bilderData => {
        const idee = { text, details, kategorie, prioritaet, bilder: bilderData, timestamp };
        const ideen = JSON.parse(localStorage.getItem("ideen") || "[]");
        ideen.push(idee);
        localStorage.setItem("ideen", JSON.stringify(ideen));
        zeigeIdeen();
        document.getElementById("ideeText").value = "";
        document.getElementById("ideeDetails").value = "";
        document.getElementById("bilder").value = "";
        prioritaet = "";
      });
    }

    function zeigeIdeen() {
      const filter = document.getElementById("filterKategorie").value;
      const sortierung = document.getElementById("sortierung").value;
      let ideen = JSON.parse(localStorage.getItem("ideen") || "[]");

      if (filter) {
        ideen = ideen.filter(i => i.kategorie === filter);
      }

      if (sortierung === "neu") {
        ideen.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
      } else if (sortierung === "alt") {
        ideen.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
      } else if (sortierung === "prio") {
        const prioWert = { Hoch: 1, Mittel: 2, Niedrig: 3 };
        ideen.sort((a, b) => prioWert[a.prioritaet] - prioWert[b.prioritaet]);
      }

      const liste = document.getElementById("ideenListe");
      liste.innerHTML = "";

      ideen.forEach((idee, index) => {
        const div = document.createElement("div");
        div.className = "idee";
        div.innerHTML = `
          <strong>${idee.text}</strong><br>
          <em>${idee.details}</em><br>
          Kategorie: ${idee.kategorie} | PrioritÃ¤t: ${idee.prioritaet}<br>
          Erstellt am: ${idee.timestamp}<br>
          ${idee.bilder.map(b => `<img src="${b}" />`).join("")}
          <div class="buttons">
            <button onclick="bearbeiteIdee(${index})">Bearbeiten</button>
            <button onclick="loescheIdee(${index})">LÃ¶schen</button>
          </div>`;
        liste.appendChild(div);
      });
    }

    function loescheIdee(index) {
      const ideen = JSON.parse(localStorage.getItem("ideen") || "[]");
      ideen.splice(index, 1);
      localStorage.setItem("ideen", JSON.stringify(ideen));
      zeigeIdeen();
    }

    function bearbeiteIdee(index) {
      const ideen = JSON.parse(localStorage.getItem("ideen") || "[]");
      const idee = ideen[index];
      document.getElementById("ideeText").value = idee.text;
      document.getElementById("ideeDetails").value = idee.details;
      document.getElementById("kategorie").value = idee.kategorie;
      prioritaet = idee.prioritaet;
      ideen.splice(index, 1);
      localStorage.setItem("ideen", JSON.stringify(ideen));
      zeigeIdeen();
    }

    function ladeFilterKategorie() {
      const select = document.getElementById("filterKategorie");
      ["", "Privat", "Arbeit", "SpÃ¤ter", "Sonstiges"].forEach(k => {
        const option = document.createElement("option");
        option.value = k;
        option.text = k || "Alle Kategorien";
        select.appendChild(option);
      });
    }

    ladeFilterKategorie();
    zeigeIdeen();
  </script>
</body>
</html>